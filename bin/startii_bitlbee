#!/bin/bash
# Vars
ROOT="$HOME/irc/bitlbee"
NICK="GGLucas"
FULLNAME="Lucas de Vries"

# Ask for password
clear
echo -n "Start ii ? [y/N] "
read -n 1 START

if [[ "$START" == "y" ]]
then
    echo ""
    read -s -p "bitlbee password: " PASSWD

    # Recreate directory
    rm -rf "$ROOT"
    mkdir "$ROOT" || exit

    # Goto root
    cd "$ROOT"

    # Start ii
    echo ""
    echo -n "Starting....   "

    ii -i $ROOT -s "localhost" -n "$NICK" -f "$FULLNAME" &> /dev/null &

    sleep 2
    echo "Done"

    echo -n "Joining channels....   "

    # Join channels
    # OFTC
    echo "/j &bitlbee" >> "localhost/in"

    sleep 2
    echo "Done"

    # Authenticate
    echo -n "Identifying....   "

    IDENT="identify $PASSWD"
    echo "$IDENT" >> "localhost/&bitlbee/in"

    sleep 2
    echo "Done"
    echo "Starting vim....   "
fi

# Start vim
cd $HOME
vim -R \
        -c "let g:ii_root = '$ROOT'" \
        -c "let g:ii_nickname = '$NICK'" \
        -c "silent call ii:start()" \
        -c "silent Bclose"
